<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Success - GameVault</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!--Navigation-->
    <nav class="top-nav">
      <div class="nav-container">
        <div class="nav-brand">
          <a href="/" class="nav-logo">GameVault</a>
        </div>
        <div class="nav-menu">
          <a href="/" class="nav-link">Home</a>
          <a href="/all-products" class="nav-link">All Products</a>
          <a href="/cart" class="nav-link"
            >Cart (<span class="cart-count" id="nav-cart-count">0</span>)</a
          >
          <a href="/orders" class="nav-link">My Orders</a>
        </div>
      </div>
    </nav>

    <!--Main Content-->
    <div class="container">
      <div class="success-celebration" id="successContent">
        <div class="success-icon">üéâ</div>
        <h2>Payment Successful!</h2>
        <div class="loading-content">
          <div class="loading-spinner"></div>
          <p>Verifying your payment and loading order details...</p>
        </div>
      </div>
    </div>

    <script>
      // Create confetti animation using your theme colors
      function createConfetti() {
        const themeColors = [
          "#ff3ca6",
          "#ff6fb9",
          "#28a745",
          "#20c997",
          "#ffc107",
        ];

        for (let i = 0; i < 50; i++) {
          setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.className = "confetti";
            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.backgroundColor =
              themeColors[Math.floor(Math.random() * themeColors.length)];
            confetti.style.animationDelay = Math.random() * 3 + "s";
            confetti.style.animationDuration = 2 + Math.random() * 2 + "s";

            // Random shapes
            if (Math.random() > 0.5) {
              confetti.style.borderRadius = "0";
              confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            }

            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 4000);
          }, i * 100);
        }
      }

      // Start confetti celebrations
      createConfetti();
      setTimeout(createConfetti, 3000);
      setTimeout(createConfetti, 6000);

      // Handle payment success display
      async function displayPaymentSuccess() {
        const successContent = document.getElementById("successContent");

        // Update cart count using the global function from core.js
        if (typeof updateCartCountDisplay === "function") {
          await updateCartCountDisplay();
        } else {
          // Fallback: set to 0 directly since cart was cleared after payment
          const cartCountEl = document.getElementById("nav-cart-count");
          if (cartCountEl) {
            cartCountEl.textContent = "0";
          }
        }

        // Get URL parameters for order details
        const urlParams = new URLSearchParams(window.location.search);
        const orderRef = urlParams.get("ref");
        const amount = urlParams.get("amount");
        const paymentId = urlParams.get("payment_id");
        const invoice = urlParams.get("invoice");
        const transactionRef = urlParams.get("transaction_ref");

        // Simulate loading and then show success details
        setTimeout(() => {
          successContent.innerHTML = `
          <div class="success-icon">‚úÖ</div>
          <h2>Payment Completed!</h2>
          <p>Your payment has been successfully processed and your order is confirmed.</p>
          
          <div class="order-details-container">
            <h3>üéÆ Order Confirmation</h3>
            ${
              orderRef
                ? `
              <div class="detail-row">
                <span class="detail-label">Order Reference:</span>
                <span class="detail-value highlight">${orderRef}</span>
              </div>
            `
                : ""
            }
            ${
              invoice
                ? `
              <div class="detail-row">
                <span class="detail-label">Invoice Number:</span>
                <span class="detail-value highlight">${invoice}</span>
              </div>
            `
                : ""
            }
            ${
              amount
                ? `
              <div class="detail-row">
                <span class="detail-label">Amount Paid:</span>
                <span class="detail-value highlight">$${parseFloat(
                  amount
                ).toFixed(2)}</span>
              </div>
            `
                : ""
            }
            ${
              paymentId
                ? `
              <div class="detail-row">
                <span class="detail-label">Payment ID:</span>
                <span class="detail-value">${paymentId}</span>
              </div>
            `
                : ""
            }
            ${
              transactionRef
                ? `
              <div class="detail-row">
                <span class="detail-label">Transaction Ref:</span>
                <span class="detail-value">${transactionRef}</span>
              </div>
            `
                : ""
            }
            <div class="detail-row">
              <span class="detail-label">Payment Method:</span>
              <span class="detail-value">Paystack</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value" style="color: #28a745;">‚úì Confirmed</span>
            </div>
          </div>
          
          <div class="success-actions">
            <a href="/orders" class="btn btn-primary">
              üìã View My Orders
            </a>
            <a href="/all-products" class="btn btn-secondary">
              üõçÔ∏è Continue Shopping
            </a>
          </div>
        `;

          // Trigger final confetti burst
          setTimeout(createConfetti, 500);
        }, 2000);
      }

      // Initialize on load
      document.addEventListener("DOMContentLoaded", displayPaymentSuccess);
    </script>
    <script src="/JS/core.js"></script>
  </body>
</html>
